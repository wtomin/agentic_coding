version: 1.0
name: convert_modeling_scripts
parallelizable: true

goal: Convert PyTorch modeling scripts to MindSpore modeling scripts.

dependencies:
  references:
    - examples/modeling_cohere2_torch.py
    - examples/modeling_cohere2.py

directories:
  inputs: ../inputs
  outputs: ../output
  examples: ../examples

steps:
  - id: inspect_output
    action: list_directory
    path: ../output
  - id: branch
    action: branch
    conditions:
      - when: output_is_empty
        next: convert_from_inputs
      - when: output_not_empty
        next: continue_on_outputs
  - id: convert_from_inputs
    condition: output_is_empty
    action: convert_torch_to_mindspore_from_inputs
    inputs_path: ../inputs
    outputs_path: ../output
    guidance:
      reference_files:
        - ../examples/modeling_cohere2_torch.py
        - ../examples/modeling_cohere2.py
  - id: continue_on_outputs
    condition: output_not_empty
    action: complete_conversion_via_diff
    path: ../output
    require_human_review: true
    guidance:
      reference_files:
        - ../examples/modeling_cohere2_torch.py
        - ../examples/modeling_cohere2.py

artifacts:
  - type: mindspore_modeling_scripts
    location: ../output
